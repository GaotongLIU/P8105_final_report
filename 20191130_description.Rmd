---
title: "20191130_description"
author: "Gaotong LIU"
date: "11/30/2019"
output: github_document
editor_options: 
  chunk_output_type: console
---
```{r setup, include=FALSE}
library(tidyverse) ## Data Manipulaion
library(corrplot) ## Correlation plot

knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE)

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis")

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d

theme_set(theme_minimal() + theme(legend.position = "bottom"))

```

## Load and tidy data
```{r}
### rename and select variables
happy = 
  read_csv("data/final_data.csv") %>% 
  rename("country" = country_name,
          "happiness_score" = life_ladder,
         "gdp" = log_gdp_per_capita,
         "life_expectance" = healthy_life_expectancy_at_birth,
         "freedom" = freedom_to_make_life_choices,
         "corruption" = perceptions_of_corruption) %>% 
  select(-c(long, lat)) %>% 
  unique() %>% 
  mutate(o_gdp = exp(gdp)) %>%# in the original data, they use log get the result, i try to transfer in the real way
  mutate(develop = ifelse(o_gdp > 25000, "developed", "developing")) # actually there is no speicific cretiria to distinguish the developed and developing country.
```

```{r}
## Creat continent variable
Asia = 
  c("Israel", "United Arab Emirates", "Singapore", "Thailand", "Taiwan Province of China",
                                   "Qatar", "Saudi Arabia", "Kuwait", "Bahrain", "Malaysia", "Uzbekistan", "Japan",
                                   "South Korea", "Turkmenistan", "Kazakhstan", "Turkey", "Hong Kong S.A.R., China", "Philippines",
                                   "Jordan", "China", "Pakistan", "Indonesia", "Azerbaijan", "Lebanon", "Vietnam",
                                   "Tajikistan", "Bhutan", "Kyrgyzstan", "Nepal", "Mongolia", "Palestinian Territories",
                                   "Iran", "Bangladesh", "Myanmar", "Iraq", "Sri Lanka", "Armenia", "India", "Georgia",
                                   "Cambodia", "Afghanistan", "Yemen", "Syria")

Europe = 
  c("Norway", "Denmark", "Iceland", "Switzerland", "Finland",
                                   "Netherlands", "Sweden", "Austria", "Ireland", "Germany",
                                   "Belgium", "Luxembourg", "United Kingdom", "Czech Republic",
                                   "Malta", "France", "Spain", "Slovakia", "Poland", "Italy",
                                   "Russia", "Lithuania", "Latvia", "Moldova", "Romania",
                                   "Slovenia", "North Cyprus", "Cyprus", "Estonia", "Belarus",
                                   "Serbia", "Hungary", "Croatia", "Kosovo", "Montenegro",
                                   "Greece", "Portugal", "Bosnia and Herzegovina", "Macedonia",
                                   "Bulgaria", "Albania", "Ukraine")

North_America = 
  c("Canada", "Costa Rica", "United States", "Mexico",  
                                   "Panama","Trinidad and Tobago", "El Salvador", "Belize", "Guatemala",
                                   "Jamaica", "Nicaragua", "Dominican Republic", "Honduras",
                                   "Haiti")

Sorth_America =  
  c("Chile", "Brazil", "Argentina", "Uruguay",
                                   "Colombia", "Ecuador", "Bolivia", "Peru",
                                   "Paraguay", "Venezuela")

Australia = 
  c("New Zealand", "Australia")

happy = happy %>% 
  mutate(continent = case_when(
    country %in% Asia ~ "Asia",
    country %in% Europe ~ "Europe",
    country %in% North_America ~ "North America",
    country %in% Sorth_America ~ "South America",
    country %in% Australia ~ "Australia",
    TRUE ~ as.character("Africa")
  ))
```

```{r}
## Standardaization
happy_standard = happy %>% 
  mutate(s_gdp = scale(gdp),
         s_social_support = scale(social_support),
         s_life_expectance = scale(life_expectance),
         s_freedom = scale(freedom),
         s_positive_affect = scale(positive_affect),
         s_negative_affect = scale(negative_affect),
         s_generosity  = scale(generosity),
         s_corruption  = scale(corruption)) %>%
  select(-c(gdp:corruption), -o_gdp)
```

## Happiness score change over time
### Mean Happiness score of all countries: worldwide
```{r}
happy %>% 
  group_by(year) %>% 
  summarise(year_mean_score = mean(happiness_score)) %>% 
  ggplot(aes(x = year, y = year_mean_score)) +
  geom_path() +
  labs(title = "happiness: 2011-2018 worldwide")
## Boxplot
happy %>% 
  group_by(year) %>% 
  ggplot(aes(x = year, y = happiness_score)) +
  geom_point(aes(group = year, color = year)) + 
  geom_boxplot(aes(group = year, color = year)) + 
  labs(title = "happiness: 2011-2018 worldwide")
```

### Mean Happiness score of continent: region
```{r}
happy %>% 
  group_by(year, continent) %>% 
  summarise(year_mean_score = mean(happiness_score)) %>% 
  ggplot(aes(x = year, y = year_mean_score, color = continent)) +
  geom_point() +
  geom_line() +
  geom_smooth(method = lm, size  = 0.5, 
              se = FALSE, color = "red") +  
  facet_grid(. ~ continent) +
  labs(title = "happiness: 2011-2018 region")
```

```{r}
happy %>% 
  group_by(year, develop) %>% 
  summarise(year_mean_score = mean(happiness_score)) %>% 
  ggplot(aes(x = year, y = year_mean_score, color = year)) +
  geom_point() +
  geom_line() +
  geom_smooth(method = lm, size  = 0.5, 
              se = FALSE, color = "red") +  
  facet_grid(. ~ develop) +
  labs(title = "happiness: 2011-2018 develop")
## Boxplot
happy %>% 
  group_by(year, develop) %>%
  ggplot(aes(x = year, y = happiness_score,
             group = develop, color = develop)) +
  geom_point(aes(group = year, color = year)) +
  geom_boxplot(aes(group = year, color = year)) +
  geom_smooth(method = lm, size  = 0.5, 
              se = FALSE, color = "red") +  
  facet_grid(. ~ develop) +
  labs(title = "happiness: 2011-2018 develop")
```
## other factors change over time
```{r}
## 2011-2018 Worldwide
happy_standard %>% 
  group_by(year) %>% 
 summarise(mean_gdp = mean(s_gdp),
            mean_social_support = mean(s_social_support),
            mean_life_expectance = mean(s_life_expectance),
            mean_freedom = mean(s_freedom),
            mean_positive_affect = mean(s_positive_affect),
            mean_negative_affect = mean(s_negative_affect),
            mean_generosity  = mean(s_generosity),
            mean_corruption  = mean(s_corruption)) %>%
  pivot_longer(mean_gdp:mean_corruption,
               names_to = "factors",
               values_to = "mean_s",
               names_prefix = "mean_"
               ) %>% 
  ggplot(aes(x = year, y = mean_s, color = factors)) +
  geom_point(alpha = .7) +
  geom_boxplot() +
  geom_smooth(method = lm, se = FALSE, 
              color =  "red", size = .5) +  
  facet_grid(.~ factors) +
  labs(title = "others: 2011-2018 worldwide")
```

```{r}
## 2011-2018 region
happy_standard %>% 
  group_by(year, continent) %>% 
 summarise(mean_gdp = mean(s_gdp),
            mean_social_support = mean(s_social_support),
            mean_life_expectance = mean(s_life_expectance),
            mean_freedom = mean(s_freedom),
            mean_positive_affect = mean(s_positive_affect),
            mean_negative_affect = mean(s_negative_affect),
            mean_generosity  = mean(s_generosity),
            mean_corruption  = mean(s_corruption)) %>%
  pivot_longer(mean_gdp:mean_corruption,
               names_to = "factors",
               values_to = "mean_s",
               names_prefix = "mean_"
               ) %>% 
  ggplot(aes(x = year, y = mean_s, color = factors)) +
  geom_point(alpha = .7) +
  geom_boxplot() +
  geom_smooth(method = lm, se = FALSE, 
              color =  "red", size = .5) +  
  facet_grid(continent ~ factors) +
  labs(title = "others: 2011-2018 region")
```

```{r}
## 2011-2018 region
happy_standard %>% 
  group_by(year, continent) %>% 
 summarise(mean_gdp = mean(s_gdp),
            mean_social_support = mean(s_social_support),
            mean_life_expectance = mean(s_life_expectance),
            mean_freedom = mean(s_freedom),
            mean_positive_affect = mean(s_positive_affect),
            mean_negative_affect = mean(s_negative_affect),
            mean_generosity  = mean(s_generosity),
            mean_corruption  = mean(s_corruption)) %>%
  pivot_longer(mean_gdp:mean_corruption,
               names_to = "factors",
               values_to = "mean_s",
               names_prefix = "mean_"
               ) %>% 
  ggplot(aes(x = year, y = mean_s, color = factors)) +
  geom_point(alpha = .7) +
  geom_boxplot() +
  geom_smooth(method = lm, se = FALSE, 
              color =  "red", size = .5) +  
  facet_grid(continent ~ factors) +
  labs(title = "others: 2011-2018 region")
```

```{r}
## 2011-2018 develop
happy_standard %>% 
  group_by(year, develop) %>% 
 summarise(mean_gdp = mean(s_gdp),
            mean_social_support = mean(s_social_support),
            mean_life_expectance = mean(s_life_expectance),
            mean_freedom = mean(s_freedom),
            mean_positive_affect = mean(s_positive_affect),
            mean_negative_affect = mean(s_negative_affect),
            mean_generosity  = mean(s_generosity),
            mean_corruption  = mean(s_corruption)) %>%
  pivot_longer(mean_gdp:mean_corruption,
               names_to = "factors",
               values_to = "mean_s",
               names_prefix = "mean_"
               ) %>% 
  ggplot(aes(x = year, y = mean_s, color = factors)) +
  geom_point(alpha = .7) +
  geom_boxplot() +
  geom_smooth(method = lm, se = FALSE, 
              color =  "red", size = .5) +  
  facet_grid(develop ~ factors) +
  labs(title = "others: 2011-2018 develop")
```

*  The other factors change over time **Not** meaningful for region

## Correlation of happiness and other factors
### Scaterplot and box plot with smooth: Worldwide
```{r}
happy_standard %>% 
  pivot_longer(s_gdp:s_corruption,
               names_to = "standard_factors",
               values_to = "standard_value") %>% 
  ggplot(aes(x = happiness_score, y = standard_value,
             color  = standard_factors)) +
  geom_point() +
  geom_boxplot() +  
  geom_smooth(method = lm, color = "red") +
  facet_grid(. ~ standard_factors) +
  labs(title = "correlation:2011-2018 worldwide")
```

### Scaterplot and box plot with smooth: Region
```{r}
happy_standard %>% 
  pivot_longer(s_gdp:s_corruption,
               names_to = "standard_factors",
               values_to = "standard_value") %>% 
  ggplot(aes(x = happiness_score, y = standard_value,
             color  = standard_factors)) +
  geom_point() +
  geom_boxplot() +  
  geom_smooth(method = lm, color = "red") +
  facet_grid(continent ~ standard_factors) +
  labs(title = "correlation:2011-2018 region")
```

### Scaterplot and box plot with smooth: develop
```{r}
happy_standard %>% 
  pivot_longer(s_gdp:s_corruption,
               names_to = "standard_factors",
               values_to = "standard_value") %>% 
  ggplot(aes(x = happiness_score, y = standard_value,
             color  = standard_factors)) +
  geom_point() +
  geom_boxplot() +  
  geom_smooth(method = lm, color = "red") +
  facet_grid(develop ~ standard_factors) +
  labs(title = "correlation:2011-2018 develop")
```
*  Correlation  **Not** meaningful for region

### Correlation plot: Worldwide
```{r}
happy_standard %>% 
  select(-c(country, year, continent, develop)) %>% 
  cor() %>%
  corrplot.mixed(title = "2011-2018 Wordwide",
                 tl.cex = .7, tl.pos = "lt",
                  mar=c(0,0,1,0))

happy_standard %>% 
  select(-c(country, year, continent, develop)) %>% 
  cor() %>%
  corrplot(method = 'square', type = "upper",
         title = "2011-2018 Wordwide",
         tl.cex = .7,
          mar=c(0,0,1,0)) 
```

### Correlation plot: Region
```{r}
happy_standard %>% 
  filter(continent == "Australia") %>% 
  select(-c(country, year, continent, develop)) %>% 
  cor() %>%
  corrplot.mixed(title = "2011-2018 Australia",
                 tl.cex = .7, tl.pos = "lt",
                  mar=c(0,0,1,0))

happy_standard %>% 
  filter(continent %in% c("Europe", "North America", "South America"))  %>% 
  select(-c(country, year, continent, develop)) %>% 
  cor() %>%
  corrplot.mixed(title = "2011-2018 Europe, North America, South America",
                 tl.cex = .7, tl.pos = "lt",
                  mar=c(0,0,1,0))

happy_standard %>% 
 filter(continent %in% c("Africa", "Asia")) %>% 
  select(-c(country, year, continent, develop)) %>% 
  cor() %>%
  corrplot.mixed(title = "2011-2018 Africa, Asia",
                 tl.cex = .7, tl.pos = "lt",
                  mar=c(0,0,1,0))
```

### Correlation plot: develop
```{r developing}
happy_standard %>% 
  filter(develop == "developing") %>% 
  select(-c(country, year, continent, develop)) %>% 
  cor() %>%
  corrplot.mixed(title = "2011-2018 developing",
                 tl.cex = .7, tl.pos = "lt",
                  mar=c(0,0,1,0))
```

```{r developed}
happy_standard %>% 
  filter(develop == "developed") %>% 
  select(-c(country, year, continent, develop)) %>% 
  cor() %>%
  corrplot.mixed(title = "2011-2018 developed",
                 tl.cex = .7, tl.pos = "lt",
                  mar=c(0,0,1,0))
```
* Different continent the strength of correlation is different,
Australia: freedom, social support

Europe, North America, South America: gdp, life expectancy, freedom, social support, corruption

Africa, Asia:  gdp, life expectancy,social support
