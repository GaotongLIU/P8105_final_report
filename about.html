<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Final report</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/spacelab.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 52px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 57px;
  margin-top: -57px;
}
.section h2 {
  padding-top: 57px;
  margin-top: -57px;
}
.section h3 {
  padding-top: 57px;
  margin-top: -57px;
}
.section h4 {
  padding-top: 57px;
  margin-top: -57px;
}
.section h5 {
  padding-top: 57px;
  margin-top: -57px;
}
.section h6 {
  padding-top: 57px;
  margin-top: -57px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Project Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">Final report</a>
</li>
<li>
  <a href="data.html">Data</a>
</li>
<li>
  <a href="https://yuqimiao.shinyapps.io/Gaotong/">Associaiton Map</a>
</li>
<li>
  <a href="global_animation_plot.html">Global Animation Map</a>
</li>
<li>
  <a href="mailto:&lt;gl2677@cumc.columbia.edu&gt;">
    <span class="fa fa-envelope fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/GaotongLIU/P8105_final_report.io.git">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore"><strong><em>Final report</em></strong></h1>

</div>


<style type = "text/css">

body{ /* Normal */
    font-size: 14px;
    color: black;
}
h1.title {
font-size: 38px;
color: darkred;
}
h2{ /* Header 2 */
font-size: 28px;
color: black;
}
h3{ /* Header 3 */
font-size: 18px;
color: black;
}
</style>
<div id="motivation" class="section level2">
<h2>Motivation</h2>
<p>Aristotle once said, “Happiness is the meaning and purpose of life.” However, as civilizations are developing, the happiness of human being becomes an ambiguous topic. Simple material enjoyment is no longer the only determinant of mental pleasure. Therefore, we wonder how the state of happiness in the world change overtime and what makes the world happy? For this purpose, 165 countries, 12 years from 2008 to 2018 and 8 factors about happiness are included in our analysis.</p>
</div>
<div id="related-work" class="section level2">
<h2>Related work</h2>
<p>Our common interest on happiness around the world and appropriate dataset online make us choose this topic.</p>
</div>
<div id="initial-questions" class="section level2">
<h2>Initial questions</h2>
<p>We sought to see the general trend of happiness, indicating by life ladder, over recent years of each country around the world. We were also interested in examining influential factors on happiness and the strength of their association. In addition, during the process of analysis, we found stratification might help the analysis and therefore, countries were divided into the developing and developed in the first model, into different regions in the second model. As such, our questions were as follows:</p>
<ul>
<li>What are the influential factors on happiness? How can we visualize these correlations?</li>
<li>How does happiness change in each country over recent years?</li>
<li>If the association differs in different regions?</li>
<li>If the association differs among developing and developed countries?</li>
</ul>
</div>
<div id="data" class="section level2">
<h2>Data</h2>
<p>The information was gathered primarily from <em>The World Happiness Report</em> created by the United Nations Sustainable Development Solutions Network <a href="https://worldhappiness.report/">(UNSDSN)</a>. Data was collected by asking respondents to value their lives today on a 0 to 10 scale, with the worst possible life as a 0 and the best possible life as a 10. This gave us a chance to compare happiness levels and inequality in different parts of the world.</p>
<p>Furthermore, we find capital longitude and latitude from <a href="https://www.kaggle.com/sabihaif/world-happiness-report-analysis/data">kaggle</a> to locate a country when drawing association map.</p>
<div id="variable-definition" class="section level3">
<h3>Variable definition</h3>
<p>Outcome and factors that we’re interested in：</p>
<ul>
<li><p><code>Life Ladder</code>: Happiness score or subjective well-being, with steps numbered from 0 at the bottom to 10 at the top.(we renamed it as happiness_score in dataset)</p></li>
<li><p><code>LOG GDP per capita</code>: the log value of GDP per capita (variable name gdp) in purchasing power parity (PPP).(we renamed it as gdp in dataset)</p></li>
<li><p><code>Social support</code>: the national average of the binary responses (either 0 or 1) to the GWP(Gallup World Poll) question “If you were in trouble, do you have relatives or friends you can count on to help you whenever you need them, or not?”(we renamed it as gdp in dataset)</p></li>
<li><p><code>Healthy life expectancy at birth</code>: Healthy life expectancies at birth are based on the data extracted from the World Health Organization’s (WHO) Global Health Observatory data repository.(we renamed it as life_expectance in dataset)</p></li>
<li><p><code>Freedom to make life choices</code>: the national average of responses (either 0 or 1) to the GWP question “Are you satisfied or dissatisfied with your freedom to choose what you do with your life?” (we renamed it as freedom&quot; in dataset)</p></li>
<li><p><code>Generosity</code>: the residual of regressing national average of response to the GWP question “Have you donated money to a charity in the past month?” on GDP per capita.</p></li>
<li><p><code>Perceptions of corruption</code>: the national average of the survey responses to two questions in the GWP: “Is corruption widespread throughout the government or not” and “Is corruption widespread within businesses or not?” The overall perception is just the average of the two 0-or-1 responses.(we renamed it as corruption in dataset)</p></li>
<li><p><code>Positive affect</code>: the average of three positive affect measures in GWP: happiness, laugh and enjoyment in the GWP, respectively the responses to “Did you experience the following feelings during A LOT OF THE DAY yesterday? How about Happiness?”, “Did you smile or laugh a lot yesterday?”, and “Did you experience the following feelings during A LOT OF THE DAY yesterday? How about Enjoyment?”.</p></li>
<li><p><code>Negative affect</code>: the average of three negative affect measures like worry, sadness and anger in GWP, respectively the responses to “Did you experience the following feelings during A LOT OF THE DAY yesterday? How about Worry?”, “Did you experience the following feelings during A LOT OF THE DAY yesterday? How about Sadness?”, and “Did you experience the following feelings during A LOT OF THE DAY yesterday? How about Anger?”</p></li>
</ul>
</div>
<div id="loading-and-tidying-data" class="section level3">
<h3>Loading and tidying data</h3>
<p>We first save the crude dataset as “<code>.xls</code>” format from the website and read it into R and call it <code>data_all</code>. The crude data includes 1704 observations and 26 variables from 2005-2018 years, 165 countries.</p>
<pre class="r"><code>data_all = read_excel(&quot;./data/WHR.xls&quot;)%&gt;% 
 janitor::clean_names() </code></pre>
<p>After reviewing the whole dataset through checking the missing values in each variable and in each year, we decide to keep variables with the number of missing values less than 100 and observations from 2007-2018.</p>
<p>Finally we obtain 11 variables with 1588 observations from 164 countries without deleting any misssing values. Then we write the new tidyed data as <code>final_data_all_country.csv</code>, which is implemented for all the following works.</p>
<pre class="r"><code>sum_na = function(x){
  sum = sum(is.na(x))
  sum}

missing_number = map(data_all,sum_na) %&gt;% 
  as.data.frame()  

final_data = 
  data_all %&gt;% 
  filter(year %in% c(2007:2018)) %&gt;% 
  select(country_name:negative_affect)

write.csv(final_data,file=&quot;data/final_data_all_country.csv&quot;,quote=F,row.names = F)</code></pre>
</div>
<div id="for-exploratory-analysis" class="section level3">
<h3>For exploratory analysis</h3>
<p>In the original data, they use log to get the result of GDP, we try to transfer it back to the real scale. We divide these countries into developing and developed country by the criteria that some <a href="https://www.investopedia.com/updates/top-developing-countries/">economists</a> prefer to see a country with per capita GDP of at least $25,000 to be declared as developed.</p>
<pre class="r"><code>happy = 
  read_csv(&quot;data/final_data_all_country.csv&quot;) %&gt;% 
   rename(&quot;country&quot; = country_name,
          &quot;happiness_score&quot; = life_ladder,
         &quot;gdp&quot; = log_gdp_per_capita,
         &quot;life_expectance&quot; = healthy_life_expectancy_at_birth,
         &quot;freedom&quot; = freedom_to_make_life_choices,
         &quot;corruption&quot; = perceptions_of_corruption)  %&gt;% 
  unique() %&gt;% 
  mutate(o_gdp = exp(gdp)) %&gt;%# in the original data, they use log get the result, i try to transfer in the real way
  mutate(develop = ifelse(o_gdp &gt; 25000, &quot;developed&quot;, &quot;developing&quot;))  # actually there is no speicific cretiria to distinguish the developed and developing country.</code></pre>
<p>We add a new variable to distinguish the continent, because we want to see whether the association of happiness scores and other factors will change dependes on variaous continents.</p>
<pre class="r"><code>Asia = 
  c(&quot;Israel&quot;, &quot;United Arab Emirates&quot;, &quot;Singapore&quot;, &quot;Thailand&quot;, &quot;Taiwan Province of China&quot;,
                                   &quot;Qatar&quot;, &quot;Saudi Arabia&quot;, &quot;Kuwait&quot;, &quot;Bahrain&quot;, &quot;Malaysia&quot;, &quot;Uzbekistan&quot;, &quot;Japan&quot;,
                                   &quot;South Korea&quot;, &quot;Turkmenistan&quot;, &quot;Kazakhstan&quot;, &quot;Turkey&quot;, &quot;Hong Kong S.A.R., China&quot;, &quot;Philippines&quot;,
                                   &quot;Jordan&quot;, &quot;China&quot;, &quot;Pakistan&quot;, &quot;Indonesia&quot;, &quot;Azerbaijan&quot;, &quot;Lebanon&quot;, &quot;Vietnam&quot;,
                                   &quot;Tajikistan&quot;, &quot;Bhutan&quot;, &quot;Kyrgyzstan&quot;, &quot;Nepal&quot;, &quot;Mongolia&quot;, &quot;Palestinian Territories&quot;,
                                   &quot;Iran&quot;, &quot;Bangladesh&quot;, &quot;Myanmar&quot;, &quot;Iraq&quot;, &quot;Sri Lanka&quot;, &quot;Armenia&quot;, &quot;India&quot;, &quot;Georgia&quot;,
                                   &quot;Cambodia&quot;, &quot;Afghanistan&quot;, &quot;Yemen&quot;, &quot;Syria&quot;)

Europe = 
  c(&quot;Norway&quot;, &quot;Denmark&quot;, &quot;Iceland&quot;, &quot;Switzerland&quot;, &quot;Finland&quot;,
                                   &quot;Netherlands&quot;, &quot;Sweden&quot;, &quot;Austria&quot;, &quot;Ireland&quot;, &quot;Germany&quot;,
                                   &quot;Belgium&quot;, &quot;Luxembourg&quot;, &quot;United Kingdom&quot;, &quot;Czech Republic&quot;,
                                   &quot;Malta&quot;, &quot;France&quot;, &quot;Spain&quot;, &quot;Slovakia&quot;, &quot;Poland&quot;, &quot;Italy&quot;,
                                   &quot;Russia&quot;, &quot;Lithuania&quot;, &quot;Latvia&quot;, &quot;Moldova&quot;, &quot;Romania&quot;,
                                   &quot;Slovenia&quot;, &quot;North Cyprus&quot;, &quot;Cyprus&quot;, &quot;Estonia&quot;, &quot;Belarus&quot;,
                                   &quot;Serbia&quot;, &quot;Hungary&quot;, &quot;Croatia&quot;, &quot;Kosovo&quot;, &quot;Montenegro&quot;,
                                   &quot;Greece&quot;, &quot;Portugal&quot;, &quot;Bosnia and Herzegovina&quot;, &quot;Macedonia&quot;,
                                   &quot;Bulgaria&quot;, &quot;Albania&quot;, &quot;Ukraine&quot;)

North_America = 
  c(&quot;Canada&quot;, &quot;Costa Rica&quot;, &quot;United States&quot;, &quot;Mexico&quot;,  
                                   &quot;Panama&quot;,&quot;Trinidad and Tobago&quot;, &quot;El Salvador&quot;, &quot;Belize&quot;, &quot;Guatemala&quot;,
                                   &quot;Jamaica&quot;, &quot;Nicaragua&quot;, &quot;Dominican Republic&quot;, &quot;Honduras&quot;,
                                   &quot;Haiti&quot;)

Sorth_America =  
  c(&quot;Chile&quot;, &quot;Brazil&quot;, &quot;Argentina&quot;, &quot;Uruguay&quot;,
                                   &quot;Colombia&quot;, &quot;Ecuador&quot;, &quot;Bolivia&quot;, &quot;Peru&quot;,
                                   &quot;Paraguay&quot;, &quot;Venezuela&quot;)

Australia = 
  c(&quot;New Zealand&quot;, &quot;Australia&quot;)

happy = happy %&gt;% 
  mutate(continent = case_when(
    country %in% Asia ~ &quot;Asia&quot;,
    country %in% Europe ~ &quot;Europe&quot;,
    country %in% North_America ~ &quot;North America&quot;,
    country %in% Sorth_America ~ &quot;South America&quot;,
    country %in% Australia ~ &quot;Australia&quot;,
    TRUE ~ as.character(&quot;Africa&quot;)
  ))</code></pre>
<p>To better show the association of other factors and happiness score, we standardaize the value of other factors by substracting mean and devideing standard error. This is becasue the scale of <code>gdp</code> and <code>life_expectancy</code> are dramatically different from other factors.</p>
<pre class="r"><code>happy_standard = happy %&gt;% 
  mutate(s_gdp = scale(gdp),
         s_social_support = scale(social_support),
         s_life_expectance = scale(life_expectance),
         s_freedom = scale(freedom),
         s_positive_affect = scale(positive_affect),
         s_negative_affect = scale(negative_affect),
         s_generosity  = scale(generosity),
         s_corruption  = scale(corruption)) %&gt;%
  select(-c(gdp:corruption), -o_gdp)</code></pre>
</div>
<div id="for-drawing-maps" class="section level3">
<h3>For drawing maps</h3>
<p>Like data tidying for data exploratory analysis, we first read <code>final_data_all_country.csv</code> as happy1 and rename some variables in a clearer way and add new variables for drawing world map. Furthermore, we add the locations of capitals for each country by combining <a href="https://www.kaggle.com/sabihaif/world-happiness-report-analysis/data">concap.csv</a> into happy1. For some unmatched countries, we find their locations of capitals in Wikipedia. Finally, a new dataset is created for all changes stating above.</p>
<pre class="r"><code>happy1 = read_csv(&quot;data/final_data_all_country.csv&quot;) %&gt;% 
  janitor::clean_names() %&gt;% 
  unique %&gt;% 
  mutate(label = str_c(&quot;&lt;b&gt;Happiness: &quot;, round(life_ladder,2), 
                      &quot;&lt;/b&gt;&lt;br&gt;Country : &quot;, country_name,
                      sep = &quot;&quot;),
        code = countrycode(country_name, &#39;country.name&#39;, &#39;iso3c&#39;),## match code
        code = replace_na(code,&quot;XKX&quot;)) %&gt;% 
  rename(&quot;country&quot; = country_name,
         &quot;happiness_score&quot; = life_ladder,
         &quot;gdp&quot; = log_gdp_per_capita,
         &quot;life_expectance&quot; = healthy_life_expectancy_at_birth,
         &quot;freedom&quot; = freedom_to_make_life_choices,
         &quot;corruption&quot; = perceptions_of_corruption) 

location = read_csv(&quot;data/concap.csv&quot;) %&gt;% 
  janitor::clean_names() %&gt;% 
  select(country_name,capital_latitude,capital_longitude) %&gt;% 
  rename(&quot;country&quot; = country_name)

happy_location_raw = left_join(happy1, location, by = &quot;country&quot;)

# Find countries whose locations of capitals could not match
 list &lt;-which(rowSums(is.na(happy_location_raw %&gt;% 
        select(capital_latitude))) &gt; 0)
 data_all_na &lt;- happy_location_raw[list,] 
 
 happy_location_lost =  
 happy_location_raw[list,] %&gt;% 
   mutate(capital_latitude = case_when(
    country == &quot;Congo (Brazzaville)&quot; ~ -4.267778,
    country == &quot;Ivory Coast&quot; ~ 6.85,
    country == &quot;Gambia&quot; ~ 13.466667,
    country == &quot;North Cyprus&quot; ~ 35.183333,
    country == &quot;Palestinian Territories&quot; ~ 31.516667,
    country == &quot;Taiwan Province of China&quot;~ 25.066667,
    country == &quot;Somaliland region&quot;~ 9.55,
    country == &quot;Congo (Kinshasa)&quot;~ -4.316667,
    country == &quot;Hong Kong S.A.R. of China&quot;~ 114.10000
    ),
    capital_longitude = case_when(
    country == &quot;Congo (Brazzaville)&quot; ~ 15.291944,
    country == &quot;Ivory Coast&quot; ~ 5.3,
    country == &quot;Gambia&quot; ~ -16.6,
    country == &quot;North Cyprus&quot; ~ 33.366667,
    country == &quot;Palestinian Territories&quot; ~ 34.45,
    country == &quot;Taiwan Province of China&quot;~ 121.516667,
    country == &quot;Somaliland region&quot;~ 44.05,
    country == &quot;Congo (Kinshasa)&quot;~ 15.316667,
    country == &quot;Hong Kong S.A.R. of China&quot;~ 22.20000)
    ) 
    
happy_location = 
  bind_rows(happy_location_raw,happy_location_lost) %&gt;% 
  drop_na(capital_latitude,capital_longitude)</code></pre>
</div>
</div>
<div id="exploratory-analysis" class="section level2">
<h2>Exploratory analysis</h2>
<div id="happiness-score-of-all-countries-changes-over-time" class="section level3">
<h3><strong>Happiness score of all countries changes over time</strong></h3>
<p>We firstly explore the changes of happiness score over time worldwide, by continents and by developing levels.</p>
<ul>
<li><p>From the first plot, we can easily find that the mean happiness score increases from 2007 to 2010, and gradually decreases to the lowest point in 2014. Finally, it increases in the recent years. 2014, 2018</p></li>
<li><p>From the second plot, we divide these countries into different regions by the geographic continent. Australia has the overall highest and Africa has the overall lowest happiness score. Only Europe and Asia show the general increasing trend of happiness score over time.</p></li>
<li><p>We can roughly further divide these continents into three groups base on the happiness scores. The high happiness score group contains Australis, the medium happiness score group contains Europe, North America and South America, and the low happiness score group contains Africa and Asia.</p></li>
<li><p>From the third plot, the mean happiness score is obviously higher in developed countries than it in developing countries.</p></li>
</ul>
<pre class="r"><code>plot1 = happy %&gt;% 
  group_by(year) %&gt;% 
  summarise(year_mean_score = mean(happiness_score)) %&gt;% 
  ggplot(aes(x = year, y = year_mean_score)) +
  geom_path() +
  labs(title = &quot;Happiness score changes worldwide: 2007-2018&quot;,
       x = &quot;Year&quot;,
       y =  &quot;Happiness score&quot;) +
  scale_x_continuous(
    breaks = c(2007,2008,2009,2010,2011, 2012, 2013,2014,2015,2016,2017,2018))

plot2 = happy %&gt;% 
  group_by(year, continent) %&gt;% 
  summarise(year_mean_score = mean(happiness_score)) %&gt;% 
  ggplot(aes(x = year, y = year_mean_score, color = continent)) +
  geom_point() +
  geom_line() +
  geom_smooth(method = lm, size  = 0.5, 
              se = FALSE, color = &quot;red&quot;) +  
  facet_grid(. ~ continent) +
  labs(title = &quot;Happiness score changes in various continent: 2007-2018&quot;,
       x = &quot;Year&quot;,
       y =  &quot;Happiness score&quot;) +
 theme(legend.position = &quot;none&quot;)
     

plot3 = happy %&gt;% 
  drop_na(develop) %&gt;%
  group_by(year, develop) %&gt;% 
  summarise(year_mean_score = mean(happiness_score)) %&gt;% 
  ggplot(aes(x = year, y = year_mean_score, color = develop)) +
  geom_point() +
  geom_line() +
  geom_smooth(method = lm, size  = 0.5, 
              se = FALSE, color = &quot;red&quot;) +  
  facet_grid(. ~ develop) +
  labs(title = &quot;Happiness score changes in developed and developing countries: 2007-2018&quot;,
       x = &quot;Year&quot;,
       y =  &quot;Happiness score&quot;)+
 theme(legend.position = &quot;none&quot;)

plot1/plot2/plot3</code></pre>
<p><img src="about_files/figure-html/unnamed-chunk-4-1.png" width="100%" /></p>
</div>
<div id="the-correlation-plot-for-happiness-score-and-other-factors-worldwide" class="section level3">
<h3><strong>The correlation plot for happiness score and other factors: worldwide</strong></h3>
<ul>
<li><p>From the scatterplot, the factors <code>negative_affect</code> and <code>corruption</code> have the negative association with happiness score, but <code>gdp</code>, <code>social support</code>, <code>life_expectancy</code>, <code>freedom</code>, <code>positive_affect</code> and <code>generosity</code> have the positive association.</p></li>
<li><p>From the correlation matrix plot, the happiness score is highly associated with <code>gdp</code>, <code>social support</code> and <code>life_expectancy</code>(&gt; 0.7). In addition, <code>gdp</code> and <code>life_expctancy</code> are highly correlated with each other(&gt; 0.7).</p></li>
</ul>
<pre class="r"><code>happy_standard %&gt;% 
  pivot_longer(s_gdp:s_corruption,
               names_to = &quot;standard_factors&quot;,
               values_to = &quot;standard_value&quot;) %&gt;% 
  ggplot(aes(x = happiness_score, y = standard_value,
             color  = standard_factors)) +
  geom_point() +
  geom_boxplot(alpha = .8) +  
  geom_smooth(method = lm, color = &quot;red&quot;) +
  facet_grid(. ~ standard_factors) +
  labs(x = &quot;Happiness score&quot;, 
       y = &quot;Standard score of other factors&quot;, 
       title = &quot;Happiness score against other factors worldwide: 2007-2018&quot;) + 
  theme(legend.position = &quot;none&quot;)</code></pre>
<p><img src="about_files/figure-html/unnamed-chunk-5-1.png" width="50%" /></p>
<pre class="r"><code>happy_standard %&gt;% 
  drop_na() %&gt;%
  select(-c(country, year, continent, develop)) %&gt;% 
  cor() %&gt;%
  corrplot.mixed(title = &quot;Happiness score against other factors worldwide: 2007-2018&quot;,
                 tl.cex = 1.2, tl.pos = &quot;lt&quot;, number.cex = 1.2,
                  mar = c(0,0,1,0))</code></pre>
<p><img src="about_files/figure-html/unnamed-chunk-5-2.png" width="50%" /></p>
</div>
<div id="the-correlation-plot-for-happiness-score-and-other-factors-continent" class="section level3">
<h3><strong>The correlation plot for happiness score and other factors : continent</strong></h3>
<ul>
<li><p>Australia has the highest happiness score, and the score does not have high correlation with other factors(not greater than 0.4). <code>gdp</code> is strongly positively associated with <code>corruption</code>(0.69) and negatively assoicated with <code>positive_affe t</code>(-0.86)</p></li>
<li><p>Europe, North America, South America have the medium happiness score, and the score has moderate correlation with <code>gdp</code>, <code>social support</code>, <code>life_expectancy</code>, <code>freedom</code>, <code>positive_affect</code> and <code>corruption</code>(0.6 - 0.7)</p></li>
<li><p>Africa and Asia have the lowest happiness score, and the score has moderate correlation with <code>gdp</code>, <code>social support</code> and <code>life_expectancy</code>(0.6 - 0.7).</p></li>
</ul>
<pre class="r"><code>happy_standard %&gt;% 
  drop_na() %&gt;%
  filter(continent == &quot;Australia&quot;) %&gt;% 
  select(-c(country, year, continent, develop)) %&gt;% 
  cor() %&gt;%
  corrplot.mixed(title = &quot;Australia: 2007-2018&quot;,
                 tl.cex = 1.2, tl.pos = &quot;lt&quot;, number.cex = 1.2,
                  mar=c(0,0,1,0))</code></pre>
<p><img src="about_files/figure-html/unnamed-chunk-6-1.png" width="50%" /></p>
<pre class="r"><code>happy_standard %&gt;% 
  drop_na() %&gt;%
  filter(continent %in% c(&quot;Europe&quot;, &quot;North America&quot;, &quot;South America&quot;))  %&gt;% 
  select(-c(country, year, continent, develop)) %&gt;% 
  cor() %&gt;%
  corrplot.mixed(title = &quot;Europe, North America, South America: 2007-2018&quot;,
                 tl.cex = 1.2, tl.pos = &quot;lt&quot;, number.cex = 1.2,
                  mar = c(0,0,1,0))</code></pre>
<p><img src="about_files/figure-html/unnamed-chunk-6-2.png" width="50%" /></p>
<pre class="r"><code>happy_standard %&gt;% 
  drop_na() %&gt;%
 filter(continent %in% c(&quot;Africa&quot;, &quot;Asia&quot;)) %&gt;% 
  select(-c(country, year, continent, develop)) %&gt;% 
  cor() %&gt;%
  corrplot.mixed(title = &quot;Africa, Asia: 2007-2018 &quot;,
                 tl.cex = 1.2, tl.pos = &quot;lt&quot;, number.cex = 1.2,
                  mar=c(0,0,1,0))</code></pre>
<p><img src="about_files/figure-html/unnamed-chunk-6-3.png" width="50%" /></p>
</div>
<div id="the-correlation-plot-for-happiness-score-and-othe-factors-developing-level" class="section level3">
<h3><strong>The correlation plot for happiness score and othe factors : developing level</strong></h3>
<ul>
<li><p>Developing coountries have lower happiness score , and the score has moderate correlation with <code>gdp</code>, <code>social support</code> and <code>life_expectancy</code>(around 0.6).</p></li>
<li><p>Developed coountries have higher happiness score , and the score has moderate correlation with <code>social support</code>,<code>freedom</code>, <code>positive_affect</code>, <code>negative_affect</code>, <code>generosity</code> and <code>corruption</code> (around 0.6)</p></li>
</ul>
<pre class="r"><code>happy_standard %&gt;% 
  drop_na() %&gt;%
  filter(develop == &quot;developing&quot;) %&gt;% 
  select(-c( country, year, continent, develop)) %&gt;% 
  cor() %&gt;%
  corrplot.mixed(title = &quot;Developing: 2007-2018&quot;,
                 tl.cex = 1.2, tl.pos = &quot;lt&quot;, number.cex = 1.2,
                  mar=c(0,0,1,0))</code></pre>
<p><img src="about_files/figure-html/unnamed-chunk-7-1.png" width="50%" /></p>
<pre class="r"><code>happy_standard %&gt;% 
  drop_na() %&gt;%
  filter(develop == &quot;developed&quot;) %&gt;% 
  select(-c(country, year, continent, develop)) %&gt;% 
  cor() %&gt;%
  corrplot.mixed(title = &quot;Developed: 2007-2018&quot;,
                  tl.cex = 1.2, tl.pos = &quot;lt&quot;, number.cex = 1.2,
                  mar=c(0,0,1,0))</code></pre>
<p><img src="about_files/figure-html/unnamed-chunk-7-2.png" width="50%" /></p>
</div>
</div>
<div id="statistical-analysismlr" class="section level2">
<h2>Statistical Analysis(MLR)</h2>
<p>After visualization the correlation of happiness score and other factors in different levels, we decide to formally test the main effect of <code>gdp</code>, <code>social support</code>, <code>life_expectancy</code>, <code>freedom</code>, <code>positive_affect</code>, <code>negative_affect</code> , <code>generosity</code> and <code>corruption</code> on the happiness score and the <code>interaction</code> effect between several covariates.</p>
<p>By the inspiration of exploratory correlation plots, the developing levels and continent may also influence the estimates in the regression model. However, we think that the difference of correlation coefficient between continent mainly due to the developing level. Besides, we define the developing level based on the gdp, so we exclude gdp and only include the developing level as categorical variable in the final analysis.</p>
<ul>
<li>After fitting with total 8 main effects, only five of them showing significant results (P&lt;0.001), so we only use <code>social support</code>, <code>life_expectancy</code>, <code>positive_affect</code> and <code>corruption</code> to interact with <code>develop</code>.</li>
</ul>
<pre class="r"><code>data =  happy %&gt;% 
  mutate(develop = as.factor(develop),
         continent = as.factor(continent)) %&gt;%
  select(-c(country, year, o_gdp))

fit1 = lm(happiness_score~ 
            freedom + 
            negative_affect + 
            generosity + 
            social_support*develop +  
            life_expectance*develop + 
            positive_affect*develop + 
            corruption*develop, data = data)</code></pre>
<ul>
<li><p>There is a siginificant interaction effect of <code>social_support</code> and <code>develop</code>, <code>corruption</code> and <code>develop</code>. The effect of <code>social_support</code> and <code>corruption</code> on the Happiness Score is depending on the value of <code>develop</code> at 0.001 significance level.</p></li>
<li><p>There is no overall significant effect of either <code>develop</code> or <code>life_expectance</code>, but there is a significant crossover interaction at 0.001 significance level. The effect of <code>life_expectance</code> on the Happiness Score is opposite, depending on the value of <code>develop</code>.</p></li>
</ul>
<p>To interpret the results, we conduct the stratified analysis based on the developing level. Results are below, and model assumptions are checked after the discussion.</p>
<pre class="r"><code>developing =  happy %&gt;% 
  filter(develop == &quot;developing&quot;) %&gt;% 
  select(-c(o_gdp, develop, continent, country, year)) 
  
developed =  happy %&gt;% 
  filter(develop == &quot;developed&quot;) %&gt;% 
  select(-c(o_gdp, develop, continent, country, year)) 

fit2 = lm(happiness_score~., data = developing)
fit3 = lm(happiness_score~., data = developed)</code></pre>
<ul>
<li><p>For developing country, there is significant positive effect of <code>gdp</code>, <code>social_support</code>, <code>life_expectance</code> and <code>positive_affect</code> on the Happiness Score, at 0.001 siginificance level.</p></li>
<li><p>For developing cooutry, the estimate linear equation is: <span class="math inline">\(\hat{Happiness Score}\)</span> = -2.320 + 0.255 gdp + 1.525 social_support + 0.033 life_expectance + 2.304 positive_affect???</p></li>
</ul>
<pre class="r"><code>fit2 %&gt;% broom::tidy() %&gt;% knitr::kable(digits = 3)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">-2.324</td>
<td align="right">0.243</td>
<td align="right">-9.546</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">gdp</td>
<td align="right">0.248</td>
<td align="right">0.032</td>
<td align="right">7.782</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">social_support</td>
<td align="right">1.549</td>
<td align="right">0.210</td>
<td align="right">7.366</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">life_expectance</td>
<td align="right">0.033</td>
<td align="right">0.004</td>
<td align="right">7.968</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">freedom</td>
<td align="right">0.362</td>
<td align="right">0.161</td>
<td align="right">2.245</td>
<td align="right">0.025</td>
</tr>
<tr class="even">
<td align="left">generosity</td>
<td align="right">-0.139</td>
<td align="right">0.132</td>
<td align="right">-1.054</td>
<td align="right">0.292</td>
</tr>
<tr class="odd">
<td align="left">corruption</td>
<td align="right">0.086</td>
<td align="right">0.165</td>
<td align="right">0.524</td>
<td align="right">0.600</td>
</tr>
<tr class="even">
<td align="left">positive_affect</td>
<td align="right">2.322</td>
<td align="right">0.217</td>
<td align="right">10.715</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">negative_affect</td>
<td align="right">0.078</td>
<td align="right">0.230</td>
<td align="right">0.340</td>
<td align="right">0.734</td>
</tr>
</tbody>
</table>
<ul>
<li><p>For developed country, there is significant positive effect of <code>social_support</code>, <code>positive_affect</code> and <code>generosity</code>, and there is significant negative effect of <code>corruption</code> on the Happiness Score, at 0.001 siginificance level.</p></li>
<li><p>For developed cooutry, the estimate linear equation is: <span class="math inline">\(\hat{Happiness Score}\)</span> = -3.323 + 6.097 social_support + 2.095 positive_affect + 1.003 generosity -0.488 corruption???</p></li>
</ul>
<pre class="r"><code>fit3 %&gt;% broom::tidy() %&gt;% knitr::kable(digits = 3)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">-3.044</td>
<td align="right">1.470</td>
<td align="right">-2.071</td>
<td align="right">0.039</td>
</tr>
<tr class="even">
<td align="left">gdp</td>
<td align="right">0.269</td>
<td align="right">0.108</td>
<td align="right">2.492</td>
<td align="right">0.013</td>
</tr>
<tr class="odd">
<td align="left">social_support</td>
<td align="right">5.853</td>
<td align="right">0.620</td>
<td align="right">9.448</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">life_expectance</td>
<td align="right">0.010</td>
<td align="right">0.010</td>
<td align="right">1.056</td>
<td align="right">0.292</td>
</tr>
<tr class="odd">
<td align="left">freedom</td>
<td align="right">-0.620</td>
<td align="right">0.322</td>
<td align="right">-1.925</td>
<td align="right">0.055</td>
</tr>
<tr class="even">
<td align="left">generosity</td>
<td align="right">0.958</td>
<td align="right">0.181</td>
<td align="right">5.288</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">corruption</td>
<td align="right">-0.475</td>
<td align="right">0.160</td>
<td align="right">-2.968</td>
<td align="right">0.003</td>
</tr>
<tr class="even">
<td align="left">positive_affect</td>
<td align="right">2.217</td>
<td align="right">0.396</td>
<td align="right">5.605</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">negative_affect</td>
<td align="right">-0.528</td>
<td align="right">0.451</td>
<td align="right">-1.171</td>
<td align="right">0.242</td>
</tr>
</tbody>
</table>
</div>
<div id="discussion" class="section level2">
<h2>Discussion</h2>
<p>Although the happiness score slightly increases from 2007 to 2018 in the worldwide level, some regions have decreasing trend, and developed countries also have decreasing trend. It is interesting that the happiness score does not increase given the economic growth.</p>
<p>From the correlation analysis and the stratified analysis in linear regression, the happiness score is highly associated with the <code>social support</code> and <code>positive affect</code> both in developed countries and developing countries. However, <code>gdp</code> and <code>life expectancy</code> are positively associated with happiness score only in the developing countries, while <code>generosity</code> is positively , and <code>corruption</code> is negatively associated with happiness score only in the developed countries.</p>
<p>These results are reasonable and mostly what we expect. Overall, happiness score depends on economics (GDP), social support (someone to count on), health (life expectancy), positive mood (positive affect) and perceptions of corruption. For developing countries, economics and health become more important in evaluating happiness, while for developed countries, perceptions of corruption and generosity(donation) become more crucial.</p>
<p>The government of developing countries should focus more on economic growth and improving healthcare to increase the happiness perception. The government of developed countries should have policies to control the corruption in the business and government and have policies to encourage donation to increase the happiness perception.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
