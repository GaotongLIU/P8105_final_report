---
title: "20191112_Descriptive"
author: "Gaotong LIU"
date: "11/12/2019"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
library(tidyverse) ## Data Manipulaion
library(corrplot) ## Correlation plot

knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE)

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis")

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d

theme_set(theme_minimal() + theme(legend.position = "bottom"))

```

## Load and tidy data
```{r}
### rename and select variables
happy = 
  read_csv("data/final_data.csv") %>% 
  rename("country" = country_name,
          "happiness_score" = life_ladder,
         "gdp" = log_gdp_per_capita,
         "life_expectance" = healthy_life_expectancy_at_birth,
         "freedom" = freedom_to_make_life_choices,
         "corruption" = perceptions_of_corruption) %>% 
  select(-c(long, lat)) %>% 
  unique()

## Creat continent variable
Asia = 
  c("Israel", "United Arab Emirates", "Singapore", "Thailand", "Taiwan Province of China",
                                   "Qatar", "Saudi Arabia", "Kuwait", "Bahrain", "Malaysia", "Uzbekistan", "Japan",
                                   "South Korea", "Turkmenistan", "Kazakhstan", "Turkey", "Hong Kong S.A.R., China", "Philippines",
                                   "Jordan", "China", "Pakistan", "Indonesia", "Azerbaijan", "Lebanon", "Vietnam",
                                   "Tajikistan", "Bhutan", "Kyrgyzstan", "Nepal", "Mongolia", "Palestinian Territories",
                                   "Iran", "Bangladesh", "Myanmar", "Iraq", "Sri Lanka", "Armenia", "India", "Georgia",
                                   "Cambodia", "Afghanistan", "Yemen", "Syria")

Europe = 
  c("Norway", "Denmark", "Iceland", "Switzerland", "Finland",
                                   "Netherlands", "Sweden", "Austria", "Ireland", "Germany",
                                   "Belgium", "Luxembourg", "United Kingdom", "Czech Republic",
                                   "Malta", "France", "Spain", "Slovakia", "Poland", "Italy",
                                   "Russia", "Lithuania", "Latvia", "Moldova", "Romania",
                                   "Slovenia", "North Cyprus", "Cyprus", "Estonia", "Belarus",
                                   "Serbia", "Hungary", "Croatia", "Kosovo", "Montenegro",
                                   "Greece", "Portugal", "Bosnia and Herzegovina", "Macedonia",
                                   "Bulgaria", "Albania", "Ukraine")

North_America = 
  c("Canada", "Costa Rica", "United States", "Mexico",  
                                   "Panama","Trinidad and Tobago", "El Salvador", "Belize", "Guatemala",
                                   "Jamaica", "Nicaragua", "Dominican Republic", "Honduras",
                                   "Haiti")

Sorth_America =  
  c("Chile", "Brazil", "Argentina", "Uruguay",
                                   "Colombia", "Ecuador", "Bolivia", "Peru",
                                   "Paraguay", "Venezuela")

Australia = 
  c("New Zealand", "Australia")

happy = happy %>% 
  mutate(continent = case_when(
    country %in% Asia ~ "Asia",
    country %in% Europe ~ "Europe",
    country %in% North_America ~ "North America",
    country %in% Sorth_America ~ "South America",
    country %in% Australia ~ "Australia",
    TRUE ~ as.character("Africa")
  ))


## May need transformation ? for MLR?
happy_transform =
  read_csv("data/final_data.csv") %>% 
  rename("country" = country_name,
          "happiness_score" = life_ladder,
         "gdp" = log_gdp_per_capita,
         "life_expectancy" = healthy_life_expectancy_at_birth,
         "freedom" = freedom_to_make_life_choices,
         "corruption" = perceptions_of_corruption) %>% 
  mutate(log_gdp =  log(gdp),
         log_life_expectancy = log(life_expectancy)) %>% 
  select(-c(long, lat, gdp, life_expectancy)) %>% 
  unique()

happy_transform = happy_transform %>% 
  mutate(continent = case_when(
    country %in% Asia ~ "Asia",
    country %in% Europe ~ "Europe",
    country %in% North_America ~ "North America",
    country %in% Sorth_America ~ "South America",
    country %in% Australia ~ "Australia",
    TRUE ~ as.character("Africa")
  ))

```

## Factors change over time
### Happiness score change over time
### Mean Happiness score of all countries: worldwide
```{r}
happy %>% 
  group_by(year) %>% 
  summarise(year_mean_score = mean(happiness_score)) %>% 
  ggplot(aes(x = year, y = year_mean_score)) +
  geom_path()
```

### Mean Happiness score of continent: region
```{r}
happy %>% 
  group_by(year, continent) %>% 
  summarise(year_mean_score = mean(happiness_score)) %>% 
  ggplot(aes(x = year, y = year_mean_score, color = continent)) +
  geom_point() +
  geom_smooth(method = lm, se = FALSE) +  
  facet_grid(. ~ continent)
```

### Mean Happiness score of developing vs developed?

### other factors change over time
### other factors change over time: worldwide
```{r}
happy %>% 
  group_by(year) %>%
  summarise(mean_gdp = mean(gdp),
            mean_social_support = mean(social_support),
            mean_life_expectance = mean(life_expectance),
            mean_freedom = mean(freedom),
            mean_positive_affect = mean(positive_affect),
            mean_negative_affect = mean(negative_affect),
            mean_generosity  = mean(generosity),
            mean_corruption  = mean(corruption)) %>% 
  pivot_longer(mean_gdp:mean_corruption,
               names_to = "factors",
               values_to = "mean",
               names_prefix = "mean_"
               ) %>% 
  ggplot(aes(x = year, y = mean, color = factors)) +
   geom_point(alpha = .7) +
  geom_smooth(se = FALSE) +  
  facet_grid(. ~ factors)
```

### other factors change over time: region
```{r}
happy %>% 
  group_by(year, continent) %>%
  summarise(mean_gdp = mean(gdp),
            mean_social_support = mean(social_support),
            mean_life_expectance = mean(life_expectance),
            mean_freedom = mean(freedom),
            mean_positive_affect = mean(positive_affect),
            mean_negative_affect = mean(negative_affect),
            mean_generosity  = mean(generosity),
            mean_corruption  = mean(corruption)) %>% 
  pivot_longer(mean_gdp:mean_corruption,
               names_to = "factors",
               values_to = "mean",
               names_prefix = "mean_"
               ) %>% 
  ggplot(aes(x = year, y = mean, color = factors)) +
   geom_point(alpha = .7) +
  geom_smooth(se = FALSE) +  
  facet_grid(continent ~ factors)
```

* Happiness increase worldwide, only life expectancy and gdp increase worldwide.
* Happiness increase in most continents, but remain the same in Australia and  decrease in South America. However, only life expectancy seems to change. 

## Correlation of happiness and other factors
### Scaterplot and box plot with smooth: Worldwide
```{r}
## all time:2011 - 2018
happy = happy %>% 
  pivot_longer(gdp:corruption,
               names_to = "factors",
               values_to = "value") 
happy_transform = happy_transform %>% 
  pivot_longer(social_support:log_life_expectancy,
               names_to = "factors",
               values_to = "value") 
happy %>% 
  ggplot(aes(x = happiness_score, y = value, color  = factors)) +
  geom_point() +
  geom_smooth(method = lm, color = "red") +
  facet_grid(year ~ factors)+
  labs(title = "2011-2018")

#  2018
happy %>% 
  filter(year == 2018) %>% 
  ggplot(aes(x = happiness_score, y = value, color  = factors)) +
 geom_point() +
  geom_boxplot() + 
  geom_smooth(method = lm, color = "red") +
  facet_grid(. ~ factors) +
  labs(title = "2018")

## 2018:  log transform gdp, life expectancy
happy_transform %>% 
  filter(year == 2018) %>% 
  ggplot(aes(x = happiness_score, y = value, color  = factors)) +
  geom_point() +
  geom_boxplot() + 
  geom_smooth(method = lm, color = "red") +
  facet_grid(. ~ factors ) +
  labs(title = "2018 transformed gdp, life expectancy")

```

### Scaterplot and box plot with smooth: Region
```{r}
## 2011- 2018:  log transform gdp, life expectancy
happy_transform %>% 
  ggplot(aes(x = happiness_score, y = value, color  = factors)) +
  geom_point() +
  geom_boxplot() + 
  geom_smooth(method = lm, color = "red") +
  facet_grid(continent ~ factors ) +
  labs(title = "2011-2018 transformed gdp, life expectancy")

```

* Not very useful on region
* Worlwide can see positive correlation of happiness score and freedom, gdp, life expectancy, positive affect, social support. Negative: corruption, generosity, negative effect

